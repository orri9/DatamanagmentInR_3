#---
#title: "Verkefni3"
#author: "Orri Lev칤 칔lfarsson - olu2@hi.is"
#date: "March 12, 2018"
#output: html_document
#---


####Byrja 치 쭀칤 a칧 setja inn pakkana sem eg 칝tla a칧 nota
```{r}
library(ggplot2)
library(dplyr)
library(tidyr)
library(knitr)
```


#### og setja r칠tt directory
```{r}
setwd("/Users/orril/OneDrive/Skoli/Old/L岩indareikningur og T針fr吝i/R")
```




#Li칧ur A
####lesa inn skjali칧 husnaedi_stort.txt
```{r}
OLU <- read.table("husnaedi_stort.txt",header=TRUE,sep= ",")
```

####l칬gum allt inn칤 teg_eigna
```{r}
OLU$teg_eign <-as.factor(OLU$teg_eign)
levels(OLU$teg_eign)
levels(OLU$teg_eign)<-c("칍sam쭃kktar","칈b칰칧areign","칈b칰칧arh칰s", "Einb칳lish칰s","Fj칬lb칳lish칰s","Gistih칰s","Gistiheimili","herbergi", "Parh칰s", "Ra칧h칰s","S칠reign")
levels(OLU$teg_eign)
```

####l칬gum kdagur
```{r}
str(OLU)
names(OLU)[1]<-"kdagur"
```

####t칬kum 칰t allt sem er ekki Einb칳lish칰s, Ra칧h칰s, Einb칳lish칰s og Fj칬lb칳lish칰s
```{r}
OLU <- subset(OLU, teg_eign == "Parh칰s"|teg_eign =="Ra칧h칰s"|teg_eign =="Einb칳lish칰s"|teg_eign =="Fj칬lb칳lish칰s" )
OLU$teg_eign <- droplevels(OLU$teg_eign)
levels(OLU$teg_eign)
```

####Fermetraver칧 eigna = nuvirdi/ibm2
```{r}
OLU["fermetraverd"] <- round(OLU$nuvirdi / OLU$ibm2)
str(OLU)
```




#Li칧ur B
####hverfin okkar Mosfellsb칝r, Akranes og Flj칩tadalsh칠ra칧
```{r}
hverfi<-c(800, 3000, 7035)
```

####velja bara 쬬u akvednu hverfi og gefum 쬰im n칬fn
```{r}
OLU2 <-filter(OLU, matssvaedi %in% hverfi)
OLU2$matssvaedi <-as.factor(OLU2$matssvaedi)
levels(OLU2$matssvaedi)
levels(OLU2$matssvaedi)<-c("Mosfellsb칝r", "Akranes", "Flj칩tadalsh칠ra칧")
```

####Tafla sem s칳nir fj칬ldan
```{r}
kable(table(OLU2$matssvaedi, OLU2$teg_eign),align = 'r', digits = 3)
```

####Tafla sem s칳nir hlutfalli칧
```{r}
kable(prop.table(table(OLU2$matssvaedi, OLU2$teg_eign),1), align = 'r', digits = 2)
```

####Mynd sem s칳nir fj칬lda eigna af hverri tegund
```{r out.width="1600px", out.height="100px"}
ggplot(OLU2,aes(x=matssvaedi, fill=matssvaedi)) +
                  geom_bar() +
                  facet_grid(~teg_eign, margins= TRUE) +
                  xlab('Hverfi') +
                  ylab('Fj칬ldi 칤b칰칧a') + 
                  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```
H칠r er ekki tafla fyrir fj칬lb칳lish칰s 쭀칤 쬬칧 eru engin fj칬lb칳lish칰s 칤 hverfunum.

                  
                  

#Li칧ur C
####B칰um til n칳ja t칬flu
```{r}
OLU.rvk<-filter(OLU, svfn=="0")
```

####B칰um til breytuna
```{r}
OLU.rvk["ibm2.flokk"] <-  ifelse(OLU.rvk$ibm2<50, "mj칬glitlar",
                          ifelse(OLU.rvk$ibm2<80, "litlar",
                          ifelse(OLU.rvk$ibm2<110, "mi칧lungs",
                          ifelse(OLU.rvk$ibm2<140, "st칩rar",
                          ifelse(OLU.rvk$ibm2>=140, "mj칬g st칩rar",
                                          NA  )))))
str(OLU.rvk$ibm2.flokk)
```

####Gerum t칬fluna
```{r}
kable(OLU.rvk %>%
  group_by(teg_eign,ibm2.flokk) %>%
  dplyr::summarise(Medal_fermetraverd = mean(fermetraverd), 
        Stadalfravik = sd(fermetraverd, na.rm= TRUE), fjoldi = n()), align = 'r', digits = 2)
```

Flest h칰s falla undir st칩r e칧a mj칬g st칩r me칧 쬰ssari flokkun okkar. Einb칳lish칰sin eru 쬬u einu sem koma 칤 칬llum mismunandi st칝r칧unum. 료칧 eru ekki til mj칬g l칤til Fj칬lb칳lish칰s, Parh칰s e칧a ra칧h칰s. 료칧 eru engin mi칧lungs st칩r fj칬lb칳lish칰s.




#Li칧ur D
####Veljum hverfin
```{r}
OLU.Selja <-filter(OLU, matssvaedi %in% 150)
OLU.Holar <-filter(OLU, matssvaedi %in% 160)
set.seed(0510)
```

####Veljum Eignir
```{r}
OLU.Selja.Sample <- sample_n(OLU.Selja, 50)
OLU.Holar.Sample <- sample_n(OLU.Holar, 50)
```

####Sameinum
```{r}
OLU.HogS.Sample <- rbind(OLU.Holar.Sample, OLU.Selja.Sample)
str(OLU.HogS.Sample)
```


#Li칧ur E
####Tilg치turnar m칤nar eru:
츼칧ur en vi칧 f칬rum a칧 gera svokalla칧a t.pr칩fun 치 muninum 치 tveim 칩h치칧um me칧alt칬lum k칬nnum vi칧 hvort a칧 $\sigma_1^2 = \sigma_2^2$ e칧a hvort a칧  $\sigma_1^2 \neq \sigma_2^2$
$N칰lltilg치tan \space er, \space H_0: \mu_1  - \mu_2 = 0$ sem v칝ri 쮂 $H_0: \sigma_1^2 = \sigma_2^2$

$Gagntilg치tan\space er, \space H_1: \mu_1 - \mu_2 \neq 0$ sem v칝ri 쮂 $H_1: \sigma_1^2 \neq \sigma_2^2$

료r sem $\sigma_1^2$ er dreifni fermetraver칧s 칤 Seljahverfi og $\sigma_2^2$ er dreifni fermetraver칧s 칤 H칩lar og Berg.

####Gerum bartlett pr칩fun
```{r}
bartlett <- c<-bartlett.test(fermetraverd ~ matssvaedi, data = OLU.HogS.Sample)
bartlett
```

뤢 h칬fum vi칧 sanna칧 a칧 $H_0$ s칠 ekki endilega satt og gerum 쭀칤 r치칧 fyrir a칧 dreifni fermetraver칧sins s칠 ekki 쬬칧 sama 칰t fr치 Bartlett pr칩finu.

####Gerum anna칧 pr칩f
```{r}
Prof.1 <- t.test(fermetraverd ~ matssvaedi, 
                   var.equal = FALSE, data=OLU.HogS.Sample)
Prof.1
```

Til a칧 kanna mun 치 me칧alt칬lum ($\mu_1 \space og \space \mu_2$) 칰r tveim 칩h치칧um 쮂쫚쌋m, notum vi칧 svokalla칧a t.pr칩f sem fylgir T-dreifingu $T \thicksim t_{85}$, vi칧 skilgreinum $t_{\alpha,r}$ me칧 $t_{\alpha/2,r}$ e칧a $t_{0.025,85}$), sem m치 n치lga vi칧 sta칧la칧a normaldreifingu $Z \thicksim (0,1)$.


Pr칩fst칝r칧in okkar er `r round(Prof.1$statistic,3)`.  P.gildi칧 sem er reikna칧 칰tfr치 gildi pr칩fst칝r칧arinnar er  $p$ = `r (Prof.1$p.value)`. 칐ryggisbil fyrir mismun me칧altalanna tveggja er `r round(Prof.1$conf.int,3)` 칰t fr치 gefnum uppl칳singum dr칬gum vi칧 쮂 치lyktun a칧 munurinn er m칬gulega = 0 og h칬fum 쮂 sanna칧 $H_0$




#Li칧ur F
####B칰um til breytuna
```{r}
OLU.HogS.Sample["erbadkar"] <-  ifelse(OLU.HogS.Sample$fjbkar==0, "NEI",
                                ifelse(OLU.HogS.Sample$fjbkar>0, "J츼",
                                          NA  ))

kable(table(OLU.HogS.Sample$erbadkar),align="c", digits = 3)
```

####Sko칧um a칧eins g칬gnin og undirb칰m pr칩fi칧
```{r}
kable(table(OLU.HogS.Sample$matssvaedi,OLU.HogS.Sample$erbadkar),align = 'l', digits = 3)
kable(prop.table(table(OLU.HogS.Sample$matssvaedi,OLU.HogS.Sample$erbadkar), margin = 1),align="l", digits = 3)
p.test <- prop.test(table(OLU.HogS.Sample$matssvaedi,OLU.HogS.Sample$erbadkar))
```

Vi칧 gerum prop.test() skipun, til a칧 sj치 hvort a칧 쬬칧 s칠 munur 치 hlutfalli eigna me칧 ba칧kari 칤 hverfunum. 료r sem $p_S$ er hlutfall eigna 칤 Seljahverfi sem ekki eru me칧 ba칧kar og $p_H$ er hlutfall eigna 칤 H칩la hverfi sem ekki eru me칧 ba칧kar.

$$H_0: p_S - p_H = 0$$
$$H_1:p_S - p_H \neq 0$$
```{r}
p.test
```

Pr칩fi칧 er me칧 pr칩fst칝r칧 = `r round(p.test$statistic,3)` me칧 $(r-1)(s-1)=(2-1)(2-1)=1$ fr칤gr치칧u og p.gildi reikna칧 칰tfr치 gildi pr칩fst칝r칧arinnar er  $p$ = `r round(p.test$p.value,3)`. 칐ryggisbil fyrir mismun hlutfallana tveggja er `r round(p.test$conf.int,3)`. Vi칧 sj치um b칝칧i 치 칬ryggisbilinu og 칰t fr치 p.gildinu $>.05$ sem eru 쬬u $\alpha$ m칬rk sem vi칧 g치fum okkur 칤 upphafi, a칧 samkv칝mt gefnum uppl칳singum h칬fnum vi칧 ekki $H_0$ og gerum 쮂 r치칧 fyrir 쭀칤 a칧 쬬칧 s칠 enginn munur 치 milli hlutfalla eigna sme hafa ba칧kar og 쬰irra sem hafa 쬬칧 ekki 칤 hverfunum tveimur. Vi칧 쬰ssu m치tti b칰ast eftir forsko칧un gaagnanna 쬬r sem 쬬r s칠st a칧 a칧eins 4 h칰s 칤 칬칧ru hverfinu eru ekki me칧 ba칧kar en 칬ll h칰in 칤 hinu hverfinu er me칧 ba칧kar




#Li칧ur G
####Teiknum myndina
```{r}
ggplot(OLU.Selja.Sample, aes(x=ibm2, y=nuvirdi, colour="purple")) +
              geom_point(aes(colour=fermetraverd)) +
              scale_color_gradient(low = "blue", high = "red", name="fermetraverd") +
              xlab('St칝r칧 eignar') +
              ylab('N칰vir칧i eignar') +
              facet_grid(~matssvaedi) +
              geom_smooth(method = "lm",colour="blue")
```
